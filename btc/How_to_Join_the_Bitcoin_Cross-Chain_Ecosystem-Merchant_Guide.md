<h1 align="center">How to Join the Bitcoin Cross Chain Ecosystem: Vendor Guide</h1>
<h4 align="center">Version 1.0 </h4>

English | [中文](https://github.com/ontio/cross-chain/blob/master/btc/How_to_Join_the_Bitcoin_Cross-Chain_Ecosystem-Merchant_Guide_CN.md)

## Introduction

The term vendors refers to the parties, both indiviuduals and institutions, interested in providing cross chain transfer services. They do so by first registering a multi-signature account on the Bitcoin network. Customers simply send their cross chain transfer amount to this address, and the cross chain ecosystem carries out the actual transfer process. The vendor needs relayers that monitor the relay chain, and sign transasctions.

The BTC that are transferred cross chain are locked in the multi-signature address. The customers thus need to trust vendors along with vendors having to ensure that they are trustworthy and take care of all the asset risks involved.

Say there are three business collaborators named Alice, Bob, and Carl. Bitcoin interests them, and so does the associated decentralized technology. Now they want to start a BTC business with a high level of complexity. But they are facing issues due the many limitations of the Bitcoin platform. So they want to make their business work in a cross chain ecosystem. As cross chain vendors they transfer BTC to other chains, such as Ethereum, and use the smart contract technology to provide their intended cross chain services. Let us take a closer look at how they go about becoming cross chain vendors.

## Cross Chain Setup

1. **Bitcoin Network:** Alice, Bob, and Carl all individually prepare their respective **BTC private keys**. They use their private keys to generate a multi-signature redeem script that requires at least two of three collaborators to sign a transaction. The `P2WSH` and `P2SH` multi-signature address is generated by this redeem script. The main purpose served by the multi-signature addresses is to lock the transferred BTC. Carrying out this action requires the majority approval from the collaborators. Operation such as generating private keys, the redeem script and address, etc. can be carried out using the [tool](https://github.com/ontio/cross-chain/blob/master/btc/redeem_tool_guide.md) provided.
2. **Ethereum Network:** Vendors need to develop a **smart contract** based on the ERC20 [template]() avialable for reference (here referred to as EBTC). This contract needs to be deployed on the Ethereum network. This contract will be used to receive the BTC transferred cross chain from the BTC network.
3. **Relay Chain:** Each collaborator needs to create a consortium or relay chain ecosystem **wallet**, and then register it on the relay chain to gain the ability to send and sign transactions. After completeing the registeration, everyone needs to use their private keys and sign the contract hash, contract version, and the redeem script, and then link to the relay chain. After this, the vendors also need to register the fee rate (sat/byte) charged for the transaction that releases the locked BTC and a parameter to handle the change. The process is similar to contract registration; everyone signs and sends it to the relay chain. The process can be carried out using the [btctool](https://github.com/ontio/cross-chain/blob/master/btc/cross-chain_transaction_construction_tool_user_manual.md).
4. **Signing Tool:** Next, every collaborator needs to download the [signing tool](https://github.com/ontio/cross-chain/blob/master/btc/redeem_tool_guide.md). This tool is used to monitor the transactions on the consortium chain. When there is an amount of BTC transferred back to the BTC network from Ethereum, Alice, Bob and Carl all use their respective private keys to sign the transaction to release the locked BTC in the multi-signature contract. Finally, a multi-signature transaction is created on the relay chain and sent to the Bitcoin network.

## Starting a New Cross Chain Service

### Tasks to be performed by the vendor

- **Locking BTC:** The amount of BTC that the user wants to transfer to the target chain is sent to the multi-signature address by the user, where it is "locked". After the BTC is locked, the cross chain ecosystem generates and sends the cross chain tokens to the specified receiving address on the target chain, thus completing the cross chain transfer. This process does not require any operations on the vendor's end.
- **Releasing BTC:** When BTC is transferred back to the Bitcoin network the relay chain helps the vendor create a transaction that releases the locked BTC in the multi-signature account and return it back to the user. The transaction fee is paid by the user themselves, and it deducted from the transfer amount. When the transaction is created by the relay chain, it is picked up by the signing tool. All the collaborators need to sign the transaction, which is then transferred to the BTC network. In the end, the relay chain combines the signatures and the transaction, and broadcasts it to the BTC network. The vendor does not need to maintain the UTXO of the multi-chain address as the relay chain takes care of that.

### Vendor Starts a New Service

- **第一步，部署以太坊合约**：将准备好的EBTC合约部署到以太坊上，准备接收比特币，合约模板请见[此]()，修改合约内的Redeem脚本为商家自己的多签脚本即可。
- **第二步，启动签名工具**：按照[说明](https://github.com/zouxyan/cross-chain/blob/master/btc/redeem_tool_guide.md)，把自己的私钥加密后导入工具，启动工具监听联盟链并提交自己的签名。
- **第三步，BTC到以太坊**：按照特定的格式[构造交易](https://github.com/ontio/cross-chain/blob/master/btc/cross-chain_transaction_construction_tool_user_manual.md)，发送比特币到多签地址，活跃在跨链生态中的Relayer就会把这些跨链交易转发到联盟链，最终比特币会准确地发送到EBTC指定的账户中了。比如Alice在交易中写入了EBTC合约的地址、自己以太坊的地址和以太坊的chain id，并发送了1BTC到多签地址，在这笔交易拥有6个确认之后，Alice发现自己多了1个EBTC，而发送到多签地址的1BTC则被锁住。
- **第四步，BTC回比特币**：Alice想把自己的1EBTC转回比特币链，于是直接调用EBTC合约的接口，填入要转回的金额、比特币地址、比特币chain id等信息，一段时间后，发现签名工具对一笔交易进行了签名，这笔交易就是多签用来释放Alice比特币的，同时另外两人的签名工具也会签名，最终这笔交易会被Relayer成功广播到比特币网络中，这时候Alice会看到这笔交易，但是她发现转回来的比特币不足1BTC，因为这笔多签交易的手续费需要Alice支付，这是跨链生态所要求的，不过手续费并不多，Alice表示完全能接受。

经过测试（上述第三、四步商家可以不做），三人开始基于EBTC开发自己的比特币业务合约，他们终于能在以太坊智能合约上实现自己天马行空的想法了，这多亏了跨链生态！

同样地，按照协议开发一本本体或者其他链的合约，它将作为BTC在本体上的映射，与比特币保持一比一的关系，也可以通过修改[模板]()的Redeem脚本后使用，这里称作OBTC。将准备好的OBTC合约部署到本体网络上，可以通过[smartx](https://smartx.ont.io/)其余步骤和以太坊类似。

#### Step 1: Deploying a contract on Ethereum

The EBTC contract is deployed on the Ethereum chain